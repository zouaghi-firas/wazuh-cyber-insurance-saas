<!--
  Custom Wazuh Rules for Multi-Tenant Cyber Insurance PoC
  These rules simulate cyber threats that might trigger insurance claims
  Each rule is assigned to a specific organization for tenant isolation
-->
<group name="cyber_insurance,">
  <!-- EICAR ransomware detection rule for org-1 -->
  <rule id="100001" level="12">
    <if_sid>550</if_sid>
    <field name="md5">44d88612fea8a8f36de82e1278abb02f</field>
    <description>EICAR test file detected - Possible ransomware test file</description>
    <group>cyber_insurance,org-1,antivirus,eicar,ransomware</group>
    <mitre technique="T1204.002" />
    <info type="text">EICAR test files are industry-standard antivirus test signatures</info>
  </rule>

  <!-- SSH brute-force detection rule for org-1 -->
  <rule id="100002" level="10" frequency="6" timeframe="120">
    <if_sid>5710</if_sid>
    <description>SSH brute-force attack detected - Multiple failed login attempts</description>
    <group>cyber_insurance,org-1,authentication_failures,sshd,brute_force</group>
    <mitre technique="T1110.001" />
    <info type="text">Multiple SSH authentication failures within a short time period</info>
  </rule>

  <!-- Privilege escalation detection rule for org-2 -->
  <rule id="100003" level="8">
    <if_sid>5400</if_sid>
    <match>sudo:|su:</match>
    <description>Privilege escalation attempt detected - Sudo or su usage</description>
    <group>cyber_insurance,org-2,privilege_escalation,sudo</group>
    <mitre technique="T1548.003" />
    <info type="text">Attempts to gain higher privileges through sudo or su</info>
  </rule>

  <!-- Network scanning detection rule for org-3 -->
  <rule id="100004" level="7">
    <if_sid>5716</if_sid>
    <match>nmap|masscan|zmap|unicornscan|netscan</match>
    <description>Network reconnaissance tool detected - Network scanning activity</description>
    <group>cyber_insurance,org-3,reconnaissance,network_scan</group>
    <mitre technique="T1046" />
    <info type="text">Network scanning tools detected in system logs</info>
  </rule>

  <!-- Suspicious file modification detection rule for org-4 -->
  <rule id="100005" level="6">
    <if_sid>550</if_sid>
    <field name="file">/etc/passwd|/etc/shadow|/etc/sudoers|/etc/hosts|/etc/cron.d|/etc/init.d|/etc/ld.so.preload</field>
    <description>Critical system file modification - Potential system compromise</description>
    <group>cyber_insurance,org-4,system_integrity,file_modification</group>
    <mitre technique="T1565.001" />
    <info type="text">Unauthorized modification of critical system files</info>
  </rule>

  <!-- Multi-tenant organization labeling rules -->
  <!-- These rules ensure proper labeling for Document Level Security (DLS) -->
  <rule id="100010" level="0">
    <decoded_as>syslog</decoded_as>
    <field name="agent.name">org-1-agent</field>
    <description>Organization label for org-1 - INSURER1 tenant</description>
    <group>org-1,INSURER1</group>
  </rule>

  <rule id="100011" level="0">
    <decoded_as>syslog</decoded_as>
    <field name="agent.name">org-2-agent</field>
    <description>Organization label for org-2 - INSURER1 tenant</description>
    <group>org-2,INSURER1</group>
  </rule>

  <rule id="100012" level="0">
    <decoded_as>syslog</decoded_as>
    <field name="agent.name">org-3-agent</field>
    <description>Organization label for org-3 - INSURER2 tenant</description>
    <group>org-3,INSURER2</group>
  </rule>

  <rule id="100013" level="0">
    <decoded_as>syslog</decoded_as>
    <field name="agent.name">org-4-agent</field>
    <description>Organization label for org-4 - INSURER2 tenant</description>
    <group>org-4,INSURER2</group>
  </rule>

  <!-- Tenant-level aggregation rules -->
  <!-- These rules aggregate events by tenant for dashboard visualization -->
  <rule id="100020" level="0">
    <if_sid>100010,100011</if_sid>
    <field name="agent.labels.tenant">INSURER1</field>
    <description>INSURER1 tenant events aggregated for dashboard</description>
    <group>INSURER1,tenant_aggregation</group>
  </rule>

  <rule id="100021" level="0">
    <if_sid>100012,100013</if_sid>
    <field name="agent.labels.tenant">INSURER2</field>
    <description>INSURER2 tenant events aggregated for dashboard</description>
    <group>INSURER2,tenant_aggregation</group>
  </rule>

  <!-- Additional cyber insurance specific rules -->
  <!-- These rules provide additional context for insurance claim processing -->

  <!-- High-risk activity detection rule -->
  <rule id="100030" level="12">
    <if_sid>100001,100002,100003,100004,100005</if_sid>
    <field name="rule.id">100001,100002,100003,100004,100005</field>
    <description>High-risk cyber activity detected - Potential insurance claim trigger</description>
    <group>cyber_insurance,high_risk,insurance_claim</group>
    <mitre technique="T1565.001,T1204.002,T1110.001,T1046,T1548.001,T1204.002" />
    <info type="text">Multiple high-risk events detected within a short time period</info>
  </rule>

  <!-- Claim eligibility verification rule -->
  <rule id="100031" level="5">
    <if_sid>100030</if_sid>
    <field name="agent.labels.organisation">org-1,org-2,org-3,org-4</field>
    <description>Insurance claim eligibility verification - Organization coverage check</description>
    <group>cyber_insurance,claim_verification</group>
    <info type="text">Verifying all organizations have active monitoring</info>
  </rule>
</group>